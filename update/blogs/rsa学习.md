# 预备知识

## 参考文章

[<https://blog.csdn.net/gulang03/article/details/81176133>](<https://blog.csdn.net/gulang03/article/details/81176133>)

[<https://bbs.pediy.com/thread-254252.htm>](<https://bbs.pediy.com/thread-254252.htm>)



## 欧拉公式

欧拉函数是求小于**x**并且和**x**互质的数的个数。

其通式为：**φ(x) = x(1-1/p1)(1-1/p2)(1-1/p3)(1-1/p4)…..(1-1/pn)**。

其中**p1, p2……pn**为x的所有质因数，**x**是不为0的整数。**质因数**（**素因数**或**质因子**）在[数论](https://baike.baidu.com/item/%E6%95%B0%E8%AE%BA/3700)里是指能整除给定正[整数](https://baike.baidu.com/item/%E6%95%B4%E6%95%B0)的**质数**

欧拉函数是求小于x并且和x互质的数的个数*。这里我可以列举一个例子：

令x = 16，那么x的所有质因数为：**φ(16) = 16 \* (1 - 1/2) = 8**

我们也可以枚举出所有比16小，且与16互质的数：**1, 3, 5, 7, 9, 11, 13, 15**



## 模反元素

定义：如果两个正整数a和n互质，那么一定可以找到整数b，使得 ab-1 被n整除，或者说ab被n除的余数是1。



# RSA加密 

## 简单介绍非对称加密

![](/home/cookie/Pictures/blogs/rsa学习/1.png)

非对称加密:

a把公钥发给b,b给信息加密，用**公钥**。

a收到消息后用**私钥**解密。



## RSA加密原理

![](/home/cookie/Pictures/blogs/rsa学习/2.png)

## RSA算法加解密实现

1.随意选择两个大素数*p*和*q*，且*p不等于q*，计算*N=p***q*

 

2.计算*n*的欧拉函数*φ(n) = (p-1)(q-1)*（常用*phi(n)*表示*φ(n)*）

 

3.选择一个整数*e*，满足*1< e < φ(n)*，且*e与φ(n)* 互质（e通常取65537）

 

4.计算模反元素*d*，*ed ≡ 1 (mod φ(n))* 即求解*ex + φ(n)y = 1*方程组（利用扩展欧几里得算法可以求出*d*）

 

`d = gmpy2.invert(e, (p-1)*(q-1))`

 

5.得到公钥*（N，e）*私钥*（N，d）*

 

6.加密 *c = pow(m,e,N)*

 

7.解密 *m = pow(c,d,N)*





```markdown
gmpy2 安装

sudo apt install libmpc-dev

pip/pip3 install gmpy2

sage安装

https://mirrors.tuna.tsinghua.edu.cn/sagemath/linux/64bit/index.html
```



## 2019年unctf 不仅仅是RSA

压缩包里给出两个wav，目测有摩斯码脚本跑一下

![](/home/cookie/Pictures/blogs/rsa学习/3.png)

```
jagger@jagger-ubuntu:~/morsecc-master/morsecc-master$ python morsecc.py C1.wav 
[+] Morse Code:  _._. .____ ___... ...._ ...__ .____ ...._ ..___ ..... .____ ___.. ___.. .____ ..___ ...._ ..___ ___.. _____ ...__ ...__ ...._ ...__ _.... ...._ .____ ..___ ..... ___.. ...__ ..... _____ ___.. ...._ __... ...._ ..___ ...._ ..___ ...._ _____ .____ ____. __... ...__ ...._ ___.. ..___ __... _____ ____. ...__ ...._ ...__ __... _.... ..___ ____. ...__ __... ____. ..___ _____ ..... ...._ ____. ...__ ___.. ___.. _.... _____ __... ..... _.... ..___ _.... ..... __... ..___ __... ..... ...__ ..... .____ _.... ...__ ..___ .____ ___.. _.... _.... .____ _____ .____ ..___ __... ..... _.... ..___ _.... ...._ ...__ .____ ...._ __... .____ __... ..... ____. .____ .____ .____ __... ...__ ..... ..... __... ...__ _.... ..___ .____ ____. ___.. ___.. _____ .____ ..___ __... ..... ...__ ...._ ____. ..___ __... ...._ ____. ...._ ____. ___.. _.... .____ ..___ _____ ..... ...._ ..___ ...._ ___.. ..... __... ..___ .____ ...__ ...._ __... ...__ ..... .____
[+] Plain Text:  C1:4314251881242803343641258350847424240197348270934376293792054938860756265727535163218661012756264314717591117355736219880127534927494986120542485721347351
jagger@jagger-ubuntu:~/morsecc-master/morsecc-master$ python morsecc.py C2.wav 
[+] Morse Code:  _._. ..___ ___... ...._ ___.. ..... .____ _.... ..___ ..___ _____ ____. ...__ ..... .____ ..... ..___ ..... ___.. _____ _____ ____. ...._ ___.. ____. ...._ .____ _.... .____ ...__ ____. __... __... ____. ...._ ..___ ...._ .____ _.... __... ...._ ...._ __... ...__ __... ...__ .____ _.... __... ..... ____. ..... .____ _.... .____ ..... __... ..___ ____. ..___ ...._ .____ _____ ____. _.... _____ ..... ...__ .____ ...._ __... ..... _____ ___.. ...__ ___.. _.... ...__ _.... _.... ...__ _____ .____ __... ..___ ..___ ____. ___.. ___.. ..___ ...._ ...__ _____ ___.. ..... ____. .____ _.... .____ ...._ ..... ___.. ____. _____ ____. ...._ __... ___.. ...._ .____ ..___ ...._ .____ ___.. _.... ...__ ____. .____ __... ..___ ..___ ...._ ____. _.... _.... _____ ___.. .____ ___.. ..___ ____. ____. _____ ____. ____. _.... .____ ___.. .____ ...._ ...__ ____. .____ ___.. _____ ___.. _____ ___.. _.... __... .____ ...__ ..___ ...__ ...._ ____.
[+] Plain Text:  C2:485162209351525800948941613977942416744737316759516157292410960531475083863663017229882430859161458909478412418639172249660818299099618143918080867132349
```



两个pem跑一下

![](/home/cookie/Pictures/blogs/rsa学习/4.png)



然后脚本一把梭

```python
import libnum
import gmpy2

#n1 = 0xC461B3ED566F2D68583019170BDD5263D113BAECE3DEE6631F08A166376AC41FF5D4E90B3330E0FC26993E3B353F38F9B6B880DFBC5807636497561B7611047B
n1 = 10285341668836655607404515118077620322010982612318568968318582049362470680277495816958090140659605052252686941748392508264340665515203620965012407552377979
e =0xa105
p1 = 95652716952085928904432251307911783641637100214166105912784767390061832540987
q1 = 107527961531806336468215094056447603422487078704170855072884726273308088647617
c1 = 4314251881242803343641258350847424240197348270934376293792054938860756265727535163218661012756264314717591117355736219880127534927494986120542485721347351
#n2 = 0xA36E3A2A83FE2C1E33F285A08C3ECD36E377F4D9FFE828E2426D3ECED0A7F947631E932AEC327555511AC6D71E72686C1CB7DBBF3859A4D9A3D344FBF12A9553
n2 = 8559553750267902714590519131072264773684562647813990967245740601834411107597211544789303614222336972768348959206728010238189976768204432286391096419456339
p2 = 89485735722023752007114986095340626130070550475022132484632643785292683293897
q2 = 95652716952085928904432251307911783641637100214166105912784767390061832540987
c2 = 485162209351525800948941613977942416744737316759516157292410960531475083863663017229882430859161458909478412418639172249660818299099618143918080867132349
d1 = gmpy2.invert(e,(p1-1)*(q1-1))
d2 = gmpy2.invert(e,(p2-1)*(q2-1))

m1 = pow(c1,d1,n1)
m2 = pow(c2,d2,n2)
print(libnum.n2s(m1))
print(libnum.n2s(m2))
```



